# 医生门户 - 设置值班表/工作时间指南

## 功能概述

在 OpenEMR 中，医生通过创建 **"In Office"（在办公室）** 事件来设置自己的值班表和工作时间。这些事件定义了医生可用的时间段，患者可以在此时间段内预约。

---

## 设置方法

### 方法一：从日历创建 In Office 事件（推荐）

#### 步骤 1：访问日历

1. 登录医生账号
2. 点击顶部菜单：**Calendar（日历）**
3. 或直接访问：`/interface/main/calendar/index.php`

#### 步骤 2：创建新事件

1. 在日历页面，点击想要设置工作时间的日期
2. 或点击 **"Add Event"**（添加事件）按钮
3. 系统会打开事件编辑表单

#### 步骤 3：设置事件类型为 "In Office"

在事件编辑表单中：

1. **Category（类别）**：选择 **"In Office"**（在办公室）
   - 这是系统保留的特殊类别（`pc_catid = 2`）
   - 用于定义医生的可用工作时间

2. **Provider（医生）**：选择自己（当前登录的医生）
   - 系统会自动填充当前登录用户
   - 可以修改为其他医生（如果有权限）

3. **Date（日期）**：选择日期
   - 可以设置单日或多日

4. **Time（时间）**：设置开始时间
   - 例如：09:00 AM

5. **Duration（持续时间）**：设置工作时长
   - 例如：8 小时（480 分钟）
   - 或直接设置结束时间

#### 步骤 4：设置重复（重要！）

如果要设置每周固定的工作时间表：

1. **Repeats（重复）**：勾选此选项
2. **Repeat Type（重复类型）**：
   - 选择 **"Every week"**（每周）
   - 或 **"Every workday"**（每个工作日）
3. **Repeat on（重复于）**：
   - 选择星期几（如：周一、周二、周三等）
   - 可以多选
4. **Until（直到）**：
   - 设置结束日期（可选）
   - 留空表示永久重复

#### 步骤 5：保存

点击 **"Save"**（保存）按钮

---

### 方法二：通过 Providers 标签创建

1. **访问日历**
   ```
   Calendar → 切换到 "Providers" 标签
   ```

2. **创建事件**
   - 点击日期或 "Add Event"
   - 在表单中，系统会自动识别这是医生事件

3. **设置 In Office 事件**
   - Category: 选择 "In Office"
   - Provider: 选择自己
   - 设置时间和重复规则
   - 保存

---

## 示例：设置每周工作时间表

### 示例 1：周一至周五，每天 9:00-17:00

1. **创建事件**：
   - Category: **In Office**
   - Provider: 选择自己
   - Date: 选择任意一个周一
   - Time: **09:00 AM**
   - Duration: **8 小时**（或 End Time: 17:00）

2. **设置重复**：
   - ✅ Repeats: 勾选
   - Repeat Type: **Every week**（每周）
   - Repeat on: 选择 **Monday, Tuesday, Wednesday, Thursday, Friday**（周一到周五）
   - Until: 留空（永久）或设置结束日期

3. **保存**

### 示例 2：周一、周三、周五，每天 10:00-14:00

1. **创建事件**：
   - Category: **In Office**
   - Provider: 选择自己
   - Date: 选择任意一个周一
   - Time: **10:00 AM**
   - Duration: **4 小时**（或 End Time: 14:00）

2. **设置重复**：
   - ✅ Repeats: 勾选
   - Repeat Type: **Every week**
   - Repeat on: 选择 **Monday, Wednesday, Friday**（周一、周三、周五）
   - Until: 留空

3. **保存**

### 示例 3：单日值班（不重复）

1. **创建事件**：
   - Category: **In Office**
   - Provider: 选择自己
   - Date: 选择具体日期（如：2024-12-25）
   - Time: **08:00 AM**
   - Duration: **12 小时**（或 End Time: 20:00）

2. **设置重复**：
   - ❌ Repeats: 不勾选

3. **保存**

---

## 查看和管理值班表

### 查看自己的值班表

1. **访问日历**
2. **筛选显示**：
   - 在日历顶部，选择自己的名字（Provider 筛选）
   - 或切换到 "Providers" 标签
3. **查看 In Office 事件**：
   - 在日历上，In Office 事件会以特殊颜色显示
   - 通常显示为蓝色或浅蓝色

### 编辑值班表

1. **找到 In Office 事件**
   - 在日历上点击对应的 In Office 事件
2. **编辑**：
   - 修改时间、日期、重复规则等
   - 点击 "Save" 保存

### 删除值班表

1. **打开事件**
2. **点击 "Delete"（删除）**按钮
3. **确认删除**

---

## 重要概念

### In Office 事件的作用

1. **定义可用时间**：
   - In Office 事件定义了医生可用的时间段
   - 患者只能在这些时间段内预约

2. **显示可用性**：
   - 在患者门户中，患者查看预约时
   - 系统会显示医生的可用时间段（基于 In Office 事件）

3. **时间冲突检查**：
   - 如果医生在某个时间段有 In Office 事件
   - 患者可以在此时间段预约
   - 如果该时间段已有预约，则显示为已占用

### Out Of Office 事件

- **pc_catid = 3** 表示 "Out Of Office"（不在办公室）
- 用于标记医生不可用的时间段
- 例如：假期、会议、培训等

### 事件优先级

- **In Office**（pc_catid = 2）：医生可用
- **Out Of Office**（pc_catid = 3）：医生不可用
- **预约事件**（pc_catid = 5 或其他）：已预约的时间段

---

## 常见场景

### 场景 1：设置标准工作时间

**需求**：每周一至周五，上午 9:00-12:00，下午 14:00-17:00

**解决方案**：
- 创建两个 In Office 事件：
  1. 上午：09:00-12:00，重复：每周一至周五
  2. 下午：14:00-17:00，重复：每周一至周五

### 场景 2：设置不同日期的工作时间

**需求**：周一、周三、周五：10:00-16:00；周二、周四：14:00-18:00

**解决方案**：
- 创建两个 In Office 事件：
  1. 事件1：10:00-16:00，重复：每周一、三、五
  2. 事件2：14:00-18:00，重复：每周二、四

### 场景 3：临时调整工作时间

**需求**：下周一需要调整工作时间为 11:00-15:00

**解决方案**：
- 方法 A：编辑现有的重复事件，添加例外日期
- 方法 B：创建单日的 In Office 事件覆盖该日期

### 场景 4：设置假期（不可用时间）

**需求**：12月25日-12月31日休假

**解决方案**：
- 创建 "Out Of Office" 事件：
  - Category: **Out Of Office**
  - Date: 12月25日
  - End Date: 12月31日
  - 或创建全天事件

---

## 权限要求

- **创建/编辑事件**：需要 `patients -> appt -> write` 或 `patients -> appt -> wsome` 权限
- **查看日历**：需要 `patients -> appt` 权限

---

## 技术说明

### 数据库表

- **`openemr_postcalendar_events`**：存储所有日历事件
  - `pc_catid = 2`：In Office 事件
  - `pc_catid = 3`：Out Of Office 事件
  - `pc_aid`：医生 ID（provider ID）

### 事件类别

- **pc_catid = 2**：In Office（在办公室）
- **pc_catid = 3**：Out Of Office（不在办公室）
- **pc_catid = 5**：Office Visit（就诊预约，默认）

### 重复规则

- `pc_recurrtype = 0`：不重复
- `pc_recurrtype = 1`：每天重复
- `pc_recurrtype = 2`：每周重复
- `pc_recurrtype = 3`：每月重复
- `pc_recurrtype = 4`：每年重复
- `pc_recurrtype = 5`：工作日重复

---

## 常见问题

### Q1: 为什么患者看不到我的可用时间？

**可能原因**：
1. 没有创建 In Office 事件
2. In Office 事件的时间已过期
3. 患者选择的日期不在 In Office 事件范围内

**解决方法**：
- 检查是否已创建 In Office 事件
- 确认事件的时间范围
- 检查重复规则是否正确设置

### Q2: 如何设置不同时间段的值班？

**解决方法**：
- 创建多个 In Office 事件
- 每个事件设置不同的时间段
- 可以设置不同的重复规则

### Q3: 如何临时取消某一天的值班？

**解决方法**：
- 方法 A：创建 "Out Of Office" 事件覆盖该日期
- 方法 B：编辑重复事件，添加例外日期（如果支持）

### Q4: 值班表设置后多久生效？

**答案**：
- 立即生效
- 患者刷新预约页面后即可看到新的可用时间

### Q5: 多个医生可以共享同一个值班表吗？

**答案**：
- 每个医生需要单独设置自己的 In Office 事件
- 不能直接共享，但可以复制事件后修改 Provider

---

## 最佳实践

1. **提前设置**：
   - 建议提前设置好未来几周或几个月的工作时间表
   - 使用重复功能可以一次性设置长期的值班表

2. **定期更新**：
   - 定期检查和更新值班表
   - 及时添加假期或调整工作时间

3. **清晰标记**：
   - 使用注释字段记录特殊说明
   - 例如："仅接受预约患者"、"紧急情况可联系"

4. **备份设置**：
   - 记录常用的值班表设置
   - 方便快速创建类似的时间表

---

## 相关文件

- **事件编辑页面**: `/interface/main/calendar/add_edit_event.php`
- **日历主页面**: `/interface/main/calendar/index.php`
- **预约查找**: `/interface/main/calendar/find_appt_popup.php`
- **预约逻辑**: `/library/appointments.inc.php`

---

**总结**：医生通过创建 **"In Office"** 事件来设置自己的值班表。这些事件定义了医生可用的时间段，患者可以在此时间段内预约。使用重复功能可以快速设置每周固定的工作时间表。

---

**最后更新**: 2024
**适用版本**: OpenEMR 7.x+
