# UI映射查找流程指南

## 触发条件

当用户发送截图时，如果满足以下任一条件，应该使用映射系统：

1. **用户明确要求**：用户说"这个UI对应的配置文件是什么"、"这个界面在哪里配置"等
2. **截图包含红框标注**：用户用红框标注了某个UI区域
3. **用户询问配置相关**：用户询问"如何修改这个界面"、"这个菜单在哪里配置"等

## 查找流程

### 步骤1：分析截图
- 识别红框区域的位置（top/center/bottom/left/right）
- 提取文本内容（中文和英文）
- 识别UI元素类型（导航栏/表格/表单/按钮/标签页等）
- 识别布局特征（水平/垂直/网格）

### 步骤2：特征匹配
在 `mapping_db.json` 中查找匹配项：

1. **关键词匹配**：提取的文本是否在 `keywords` 或 `text_patterns` 中
2. **位置匹配**：红框位置是否匹配 `location`
3. **布局匹配**：UI结构是否匹配 `layout`
4. **类型匹配**：UI元素类型是否匹配 `ui_type`

### 步骤3：计算置信度
- 完全匹配所有特征：置信度 0.9-1.0
- 匹配大部分特征：置信度 0.7-0.9
- 部分匹配：置信度 0.5-0.7
- 低匹配：置信度 < 0.5（可能需要询问用户）

### 步骤4：返回结果
返回格式：
```
根据截图分析，这个UI元素对应的配置文件是：

**主要配置文件：**
- `interface/mobile/main/tabs/menu/menus/standard.json`
  - 描述：移动端主菜单配置文件
  - 置信度：95%
  - JSON路径：`$[*].label`（菜单项通过 label 字段定义）

**相关文件：**
- `interface/mobile/main/tabs/main.php`（渲染导航栏）
- `interface/mobile/main/tabs/js/tabs_view_model.js`（处理菜单点击事件）
```

## 添加新映射

当遇到新的UI元素且没有匹配项时：

1. 分析UI元素特征
2. 在 `mapping_db.json` 中添加新的映射项
3. 更新 `last_updated` 字段

## 示例

### 示例1：顶部导航栏
**用户输入**：发送截图，红框标注顶部导航栏（包含"日历"、"查找"等）

**分析结果**：
- 位置：top
- 布局：horizontal
- 关键词：["日历", "查找", "复诊", ...]
- 匹配项：`top-nav-bar-mobile`
- 置信度：0.95

**返回**：
```
这个顶部导航栏对应的配置文件是：
`interface/mobile/main/tabs/menu/menus/standard.json`
```

### 示例2：患者仪表板
**用户输入**：发送截图，红框标注患者仪表板区域

**分析结果**：
- 位置：center
- 布局：vertical
- 关键词：["Dashboard", "过敏症", "医疗问题", ...]
- 匹配项：`patient-dashboard`
- 置信度：0.9

**返回**：
```
这个患者仪表板对应的配置文件是：
`interface/patient_file/summary/demographics.php`
```
