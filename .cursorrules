# OpenEMR Development Rules

## UI映射系统使用规则

当用户发送截图（特别是带有红框标注的截图）时，如果用户询问UI元素对应的配置文件或如何修改界面，应该：

1. **自动触发映射查找**：
   - 读取 `.ui_mapping/mapping_db.json` 文件
   - 分析截图中的UI元素特征（文本、位置、布局）
   - 在映射数据库中查找匹配项
   - 返回对应的配置文件路径

2. **查找流程**：
   - 参考 `.ui_mapping/lookup_guide.md` 中的流程
   - 提取截图中的关键词、位置、布局特征
   - 计算匹配置信度
   - 返回主要配置文件和相关文件

3. **添加新映射**：
   - 如果遇到新的UI元素且没有匹配项，询问用户确认后添加到 `mapping_db.json`
   - 更新 `last_updated` 字段

4. **触发条件**：
   - 用户发送截图 + 询问配置相关
   - 用户用红框标注UI区域
   - 用户询问"这个界面在哪里配置"、"如何修改这个UI"等

## 项目特定规则

- 代码修改遵循 OpenEMR 编码规范
- 使用 4 空格缩进
- 遵循 PSR-4 命名空间规范
