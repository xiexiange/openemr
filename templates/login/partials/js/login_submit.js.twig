
<script>
    function transmit_form(element) {
        // disable submit button to insert a notification of working
        element.disabled = true;
        // nothing fancy. mainly for mobile.
        element.innerHTML = '<i class="fa fa-circle-notch fa-spin mx-1"></i><span class="sr-only">' + jsText({{ "Authenticating"|xlj }}) + '</span>';
        {% if hasSession %}
        document.cookie = {{ cookieText }};
        {% endif %}
        document.forms[0].submit();
        return true;
    }

    // 统一登录入口：admin 走 Login 逻辑，其他用户走 H5 逻辑（原 Login H5 按钮逻辑）
    function handleLogin(element) {
        var usernameInput = document.getElementById('authUser');
        var username = (usernameInput && usernameInput.value ? usernameInput.value : '').trim().toLowerCase();
        if (username === 'admin') {
            transmit_form(element);
            return;
        }
        // 非 admin：设置 appChoice=H5 后提交（与 Admin → Lists → apps 中的 Option ID 一致）
        var appSelect = document.getElementById('selApp');
        if (!appSelect) {
            var form = document.getElementById('login_form') || document.forms[0];
            if (form) {
                appSelect = document.createElement('input');
                appSelect.type = 'hidden';
                appSelect.id = 'selApp';
                appSelect.name = 'appChoice';
                form.appendChild(appSelect);
            }
        }
        if (appSelect) {
            appSelect.value = 'H5';
        }
        transmit_form(element);
    }
</script>
